#!/bin/bash

if ! command -v glow >/dev/null 2>&1; then
    sudo mkdir -p /etc/apt/keyrings
    curl -fsSL https://repo.charm.sh/apt/gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/charm.gpg
    echo "deb [signed-by=/etc/apt/keyrings/charm.gpg] https://repo.charm.sh/apt/ * *" | sudo tee /etc/apt/sources.list.d/charm.list
    sudo apt update && sudo apt install glow
fi

cat <<'EOF' | glow -p
# Syncthing Notes

## Introduction
Syncthing is a continuous file synchronization program that synchronizes files between two or more computers in real time, securely and without needing a cloud service.

## Installation

### Debian-based Systems
- Add curl dependency and Syncthing's official repository:  

   ```bash
   sudo apt install curl apt-transport-https
   curl -s https://syncthing.net/release-key.txt | sudo apt-key add -
   echo "deb https://apt.syncthing.net/ syncthing stable" | sudo tee -a /etc/apt/sources.list
   sudo apt update
   sudo apt install syncthing
   ```
- Start Syncthing as a background service:
`systemctl --user start syncthing`
- Enable Syncthing to start on boot:
`systemctl --user enable syncthing`
- Check Status, verify if Syncthing is running:
`systemctl --user status syncthing`
- Configuration, accessing Web UI
Syncthing provides a web interface by default at `http://localhost:8384`. You can configure this from any machine with the appropriate IP address.
- Adding Folders
On the web UI, go to Actions > Show ID and note the device ID for each device.
To add a folder to sync, go to the Folders tab and click Add Folder.
Select the folder path and specify the sync options.
- Accepting Devices
Devices must be added by sharing device IDs between machines.
On the web UI, click on Devices and then Add Device. Enter the device ID from the other machine.
- Folder Share Example
On first device: Add a folder and share it with another device (use the device ID shared earlier).
`syncthing --folder <folder-path> --device <device-id>`
- Ignoring Files
To ignore specific files or directories, edit the `.stignore` file in the shared folder:
```bash
*.bak
.tmp/
```
- Operation, Syncing Files
Once devices are connected and folders are shared, files will sync automatically between all devices that have the shared folder.
- Operation, temporarily pause syncing for a folder:
`syncthing --pause <folder-id>`
- Restart Syncthing:
`systemctl --user restart syncthing`
- Advanced Commands, Device Management
  To remove a device:
  `syncthing --device <device-id> --remove`
- Status and Logs:
  `syncthing --status`
- To view logs:
  `journalctl -u syncthing -f`
- Security and Encryption
Syncthing automatically encrypts data during transit using TLS. No need for manual configuration.

- Authentication
To secure the web UI with a username and password, go to the Settings > GUI tab in the web UI.
Set the username and password.
- Firewall Configuration
Syncthing uses TCP/UDP port 22000 by default. Ensure it's open on your firewall to allow syncing between devices:
```bash
sudo ufw allow 22000/tcp
sudo ufw allow 22000/udp
```

### Tips and Tricks
To run Syncthing as a system-wide service, you can configure it with systemd:
`sudo systemctl enable syncthing@<user>.service`

Updating Syncthing
`sudo apt update && sudo apt upgrade syncthing`

Accessing Remote Web UI using SSH port forwarding
`ssh -L 8384:localhost:8384 user@remote-host`

View Syncthing Logs for troubleshooting or checking Syncthing's performance:
`journalctl -u syncthing --since "1 hour ago"`

### Resources
Official website: https://syncthing.net/
Documentation: https://docs.syncthing.net/

EOF
